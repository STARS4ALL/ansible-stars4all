---

- name: create new tessdb virtual env base directory {{ new_tdb_venv_dir }} if does not exists
  ansible.builtin.file: 
    path: '{{ new_tdb_venv_dir }}'
    state: directory
    owner: '{{ new_tdb_runtime_user }}'
    group: '{{ new_tdb_runtime_user }}'
    mode: '0755'
  tags: [install]

- name: create python virtual env using uv under {{new_tdb_uv}}/.venv
  ansible.builtin.command: '{{new_tdb_uv}} venv --python 3.12'
  become: yes
  become_user: '{{ new_tdb_runtime_user }}'
  args:
    chdir: '{{ new_tdb_venv_dir }}'
    creates: '{{ new_tdb_venv_dir }}/.venv'
  tags: [install]

- name: install/upgrade tessdb-server using uv
  ansible.builtin.command: '{{new_tdb_uv}} pip install -U tessdb-server'
  become: yes
  become_user: '{{ new_tdb_runtime_user }}'
  args:
    chdir: '{{ new_tdb_venv_dir }}'
  tags: [install]
